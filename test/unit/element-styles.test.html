<html>
<head>
	<style id="globalStyles">

		.content .text-orange-specific {
			color: rgb(255, 120, 10);
		}

		.text-red {
			color: rgb(255, 0, 0);
		}

		.text-violet {
			color: rgb(238, 65, 236);
		}

		.text-yellow {
			color: rgb(255, 255, 0);
		}

		.text-green-important {
			color: rgb(0, 128, 0) !important;
		}
	</style>
</head>
<body>
<h1>light</h1>
<light-element></light-element>
<h1>shadow</h1>
<shadow-element></shadow-element>
<h1>scoped shadow</h1>
<scoped-shadow-element></scoped-shadow-element>

<script type="module">
	/* eslint-disable no-unused-expressions */
	import {runTests} from '@web/test-runner-mocha';
	import {assert, expect, nextFrame, chai} from '@open-wc/testing';
	import {TemplateElement, html, defineElement} from '../../index';

	const colorRed = 'rgb(255, 0, 0)';
	const colorViolet = 'rgb(238, 65, 236)';
	const colorYellow = 'rgb(255, 255, 0)';
	const colorOrange = 'rgb(255, 120, 10)';
	const colorGreen = 'rgb(0, 128, 0)';

	const colorComponent = 'rgb(255, 0, 10)'
	const colorComponentClass = 'rgb(26, 101, 185)'

	runTests(() => {


		class TestElement extends TemplateElement {
			styles() {
				return [`p {color: ${colorComponent}} .text-component {color: ${colorComponentClass}};`];
			}

			template() {
				return html`
					<p ref="coloredP">red content</p>
					<p ref="textComponent" class="text-component">component text</p>
					<p ref="violetP" class="text-violet">violet content</p>
					<p ref="classOrder" class="text-red text-violet">red but violet content</p>
					<div class="content">
						<slot></slot>
					</div>`;
			}
		}

		class ShadowElement extends TestElement {
			constructor() {
				super({shadowRender: true});
			}
		}

		class ScopedShadowElement extends TestElement {
			constructor() {
				super({shadowRender: true, adoptGlobalStyles: false});
			}
		}

		defineElement('scoped-shadow-element', ScopedShadowElement)
		defineElement('shadow-element', ShadowElement)
		defineElement('light-element', TestElement)

		const componentBasicStyles = async (el) => {
			await nextFrame();
			expect(getComputedStyle(el.$refs.coloredP).color).to.equal(colorComponent);
		}

		it('applies component styles in lightDom', () => componentBasicStyles(document.querySelector('light-element')));
		it('applies component styles in shadowDom', () => componentBasicStyles(document.querySelector('shadow-element')));

		const componentClasses = async (el) => {
			await nextFrame();
			expect(getComputedStyle(el.$refs.textComponent).color).to.equal(colorComponentClass);
		}

		it('applies component classes in lightDom', () => componentClasses(document.querySelector('light-element')));
		it('applies component classes in shadowDom', () => componentClasses(document.querySelector('shadow-element')));

		const globalClasses = async (el) => {
			await nextFrame();
			expect(getComputedStyle(el.$refs.violetP).color).to.equal(colorViolet);
		}
		it('applies global classes in lightDom', () => globalClasses(document.querySelector('light-element')));
		it('applies global classes in shadowDom', () => globalClasses(document.querySelector('shadow-element')));

		const respectOrder = async (el) => {
			await nextFrame();
			expect(getComputedStyle(el.$refs.violetP).color).to.equal(colorViolet);
		}
		it('respects class order in lightDom', () => respectOrder(document.querySelector('light-element')));
		it('respects class order in shadowDom', () => respectOrder(document.querySelector('shadow-element')));

		//TODO add tests for slot styling and general specifity


		it('applies component classes in scoped shadowDom', async () => {
			const el = document.querySelector('scoped-shadow-element');
			await nextFrame();
			expect(getComputedStyle(el.$refs.textComponent).color).to.equal(colorComponentClass);
		});
		it('does not apply global classes in in shadowDom', async () => {
			const el = document.querySelector('scoped-shadow-element');
			await nextFrame();
			expect(getComputedStyle(el.$refs.violetP).color).to.equal(colorComponent);
		});


	});
</script>
</body>
</html>




